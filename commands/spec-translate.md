---
description: "Validate developer-filled domain mapping — checks completeness, cross-references with spec analysis. Second step of the spec-decomposition pipeline."
allowed-tools: Read, Write, Glob, Grep
---

# /spec-translate {spec-id}

Validate the developer-filled domain mapping and prepare it for the decomposition step.

## Input

- `spec-id`: Identifier for this spec (must match a previous /spec-analyze run)

Parse from: $ARGUMENTS

## Gate

1. **Argument present**: `spec-id` must be provided
   - If missing: "Usage: /spec-translate {spec-id}"
2. **Analysis exists**: Verify `~/.claude/workspace/specs/{spec-id}/_spec-analysis.md` exists
   - If missing: "Spec analysis not found. Run `/spec-analyze {spec-id} --pdf {path} --project {project}` first."
3. **Analysis Todo complete**: Read _spec-analysis.md, check that `## Todo` section has no `- [ ]` items
   - If incomplete: "The spec analysis has incomplete items. Review and complete _spec-analysis.md before translating."
4. **Domain mapping exists**: Verify `~/.claude/workspace/specs/{spec-id}/_domain-mapping.md` exists
   - If missing: "Domain mapping template not found. It should have been generated by /spec-analyze. Re-run /spec-analyze or create _domain-mapping.md manually."
5. **No duplicate run**: Check if `_domain-mapping.md` Todo section already has all items checked
   - If all complete: "Domain mapping already validated for '{spec-id}'. To re-validate, uncheck Todo items in _domain-mapping.md."

## Execution

### Phase 1: Load Context

1. Read `~/.claude/workspace/specs/{spec-id}/_spec-analysis.md`
2. Extract the Domain Terms table (all unique terms)
3. Read `~/.claude/workspace/specs/{spec-id}/_domain-mapping.md`
4. Parse the Mapping table rows
5. Display to user:
   ```
   Starting domain mapping validation...
   - Spec ID: {spec-id}
   - Domain terms in analysis: {n}
   - Mapping entries: {m}
   ```

### Phase 2: Validate Completeness

Check each row in the Mapping table:

**Required columns (must not be empty):**
- `Spec Term` — must match a term from _spec-analysis.md Domain Terms
- `Description` — must be non-empty
- `DB Table` — must be filled or explicitly marked `N/A`
- `ORM Model` — must be filled or explicitly marked `N/A`

**Optional columns (may be empty):**
- `GraphQL Type` — can be `-` or `N/A` for non-API entities
- `Notes` — informational only

**Validation checks:**

| Check | Condition | Severity |
|-------|-----------|----------|
| Empty DB Table | Cell is empty (not `N/A`) | ERROR — blocks proceed |
| Empty ORM Model | Cell is empty (not `N/A`) | ERROR — blocks proceed |
| Missing term | Term in analysis but not in mapping | ERROR — blocks proceed |
| Extra term | Term in mapping but not in analysis | WARNING — may be intentional |
| All N/A row | DB Table, ORM Model, GraphQL Type all `N/A` | WARNING — verify this term needs no code entity |

### Phase 3: Report Results

**If errors exist:**

```
## Domain Mapping Validation: FAILED

### Errors ({n})
| # | Spec Term | Issue |
|---|-----------|-------|
| 1 | {term} | DB Table is empty |
| 2 | {term} | ORM Model is empty |
| 3 | {term} | Missing from mapping (exists in analysis) |

### Warnings ({n})
| # | Spec Term | Issue |
|---|-----------|-------|
| ... | | |

Please fix the errors in `_domain-mapping.md` and re-run:
/spec-translate {spec-id}
```

**If no errors (warnings OK):**

```
## Domain Mapping Validation: PASSED

| Metric | Count |
|--------|-------|
| Total terms | {n} |
| With DB Table | {n} |
| With ORM Model | {n} |
| With GraphQL Type | {n} |
| Marked N/A | {n} |
| Warnings | {n} |
```

If warnings exist, list them and ask:
```
⚠ {n} warnings found. Review above and confirm these are intentional.
```

### Phase 4: Update Mapping Artifact

If validation passed:
1. Update `_domain-mapping.md` Todo section — check all completed items:
   ```
   ## Todo
   - [x] All Spec Terms have DB Table filled (or marked N/A)
   - [x] All Spec Terms have ORM Model filled (or marked N/A)
   - [x] All Spec Terms have GraphQL Type filled (or marked N/A)
   - [x] Mapping reviewed by developer
   ```
2. Update the `Status` in Context section: `Template (developer input required)` → `Validated`

### Phase 5: Human Checkpoint (H2)

Request user review:

```
## Review Checklist

Please review the validated domain mapping for:
1. **Accuracy** — Do the code entities correctly represent the spec terms?
2. **Completeness** — Are there any domain concepts missing from the mapping?
3. **Consistency** — Do related terms use consistent naming patterns?

After review, proceed to decomposition:
/spec-decompose {spec-id}
```

## Output

- Updated `~/.claude/workspace/specs/{spec-id}/_domain-mapping.md` with validated status
- Validation report displayed to user

## Error Handling

| Error | Action |
|-------|--------|
| Analysis not found | Stop: "Run `/spec-analyze {spec-id} --pdf {path}` first." |
| Mapping not found | Stop: "Domain mapping template not found." |
| Validation errors | Stop: display errors, ask developer to fix and re-run |
| Mapping already validated | Stop: inform user, suggest unchecking Todo to re-validate |
